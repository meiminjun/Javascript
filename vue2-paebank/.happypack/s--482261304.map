{"version":3,"sources":["src/util/ald.js"],"names":["aladdin","require","bow","types","tryLogin","checkResponse","res","requestCount","needLoginCode","http","request","options","cb","window","__store","commit","COMMON_LOADING","err","console","info","json","JSON","parse","body","e","responseCode","indexOf","jsonp","name","url","params","_parseData","data","ret","key","encodeURIComponent","substr","_removeElement","elem","parent","parentNode","nodeType","removeChild","match","exec","jsonpCallback","Date","getTime","Math","random","toString","replace","script","document","createElement","type","src","id","undefined","getElementById","head","getElementsByTagName","appendChild","navigator","forward","back","store","localStorage","setItem","value","getItem","removeItem","clear","sessionStorage","track","record","talkingData","trackEvent","eventId","event","on","off","once","env"],"mappings":"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","file":"ald.js","sourceRoot":"/Users/apple/Documents/github/Javascript/vue2-paebank","sourcesContent":["const aladdin = require('aladdin')\nimport bow from 'bow';\n// const bow = require('bow')\nimport * as types from '../store/types';\nimport {tryLogin} from './acc';\n\n/**\n * ald和bow接口封装\n *\n *\n */\n\nfunction checkResponse(res){\n}\n\nlet requestCount = 0;\nconst needLoginCode = ['291007','291005','291001'];\n//请求相关\nexport const http = {\n    request: function (options, cb) {\n        if (requestCount++ === 0) {\n            window.__store.commit(types.COMMON_LOADING, true)\n        }\n        bow.http.request(options, function (err, res) {\n            if (requestCount === 0 || --requestCount === 0) {\n                window.__store.commit(types.COMMON_LOADING, false)\n            }\n            //公共异常处理\n            if (err) {\n                return console.info('服务器异常', err);\n            }\n            // console.log(res);\n            let json;\n            try{\n                json = JSON.parse(res.body);\n            }catch(e){\n                json = null;\n            }\n            let responseCode = json&&json.responseCode?json.responseCode:'';\n            // 在列表内的代码需要登录～\n            if(needLoginCode.indexOf(responseCode) != -1){\n                tryLogin();\n            }else{\n                cb(json || {})\n            }\n        });\n    },\n    /**\n     * JSONP跨域请求\n     *\n     *\n     * @param options\n     * @param cb\n     */\n    jsonp: function (options, cb) {\n        // if(requestCount++ === 0) {\n        //     storeInstance.commit(\"loading\", true)\n        // }\n        let name,\n            url = options.url,\n            params = options.params || {},\n            _parseData = function (data) {\n                let ret = \"\";\n                if (typeof data === \"string\") {\n                    ret = data;\n                } else if (typeof data === \"object\") {\n                    for (let key in data) {\n                        ret += \"&\" + key + \"=\" + encodeURIComponent(data[key]);\n                    }\n                }\n                // 加个时间戳，防止缓存\n                // ret += \"&_time=\" + (new Date()).getTime();\n                ret = ret.substr(1);\n                return ret;\n            },\n            _removeElement = function (elem) {\n                let parent = elem.parentNode;\n\n                if (parent && parent.nodeType !== 11) {\n                    parent.removeChild(elem);\n                }\n            };\n\n        url = url + (url.indexOf(\"?\") === -1 ? \"?\" : \"&\") + _parseData(params);\n\n        let match = /callback=(\\w+)/.exec(url);\n\n        if (match && match[1]) {\n            name = match[1];\n        } else {\n            name = options.jsonpCallback || \"jsonp_\" + (new Date()).getTime() + '_' + Math.random().toString().substr(2);\n            url = url.replace(\"callback=?\", \"callback=\" + name);\n            url = url.replace(\"callback=%3F\", \"callback=\" + name);\n        }\n\n        let script = document.createElement(\"script\");\n        script.type = \"text/javascript\";\n        script.src = url;\n        script.id = \"id_\" + name;\n\n        window[name] = function (json) {\n            window[name] = undefined;\n            let elem = document.getElementById(\"id_\" + name);\n            _removeElement(elem);\n            // if(requestCount === 0 || --requestCount === 0){\n            //     storeInstance.commit(\"loading\", false)\n            // }\n            cb(json);\n        };\n\n        // 在head里面插入script元素\n        let head = document.getElementsByTagName(\"head\");\n        if (head && head[0]) {\n            head[0].appendChild(script);\n        }\n    }\n};\n\n//跳转相关\nexport const navigator = {\n    forward: function (options) {\n        bow.navigator.forward(options);\n    },\n    back: function () {\n        bow.navigator.back();\n    }\n};\n\n//存储相关\nexport const store = {\n    localStorage: {\n        setItem: function (options, cb) {\n            aladdin.localStorage.setItem(options.key, options.value, true, '3DES', cb);\n        },\n        getItem: function (key, cb) {\n            aladdin.localStorage.getItem(key, true, '3DES', cb);\n        },\n        removeItem: aladdin.localStorage.removeItem,\n        clear: aladdin.localStorage.clear\n    },\n    sessionStorage: {\n        setItem: aladdin.sessionStorage.setItem,\n        getItem: aladdin.sessionStorage.getItem,\n        removeItem: aladdin.sessionStorage.removeItem,\n        clear: aladdin.sessionStorage.clear\n    }\n};\n\n//埋点\nexport const track = {\n    record: function (options) {\n        console.info(options);\n        bow.talkingData.trackEvent({ eventId: options });\n    }\n};\n\n//事件\nexport const event = {\n    on: function (event, cb) {\n        bow.on && bow.on(event, cb);\n    },\n    off: function (event, cb) {\n        bow.on && bow.off(event, cb);\n    },\n    once: function (event, cb) {\n        bow.on && bow.once(event, cb);\n    }\n};\n\n//环境检测\nexport const env = {\n    ...(aladdin.env || {})\n    //其它\n};\n"]}