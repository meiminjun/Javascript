{"version":3,"sources":["src/util/acc.js"],"names":["aladdin","bow","api","ald","ua","navigator","userAgent","getForwardUrl","prefix","search","hash","param","ohash","returnUrl","url","location","href","urls","split","forwardUrl","onelogin","encodeURIComponent","replaceList","checkReplace","p","pathname","a","length","substr","lastIndexOf","indexOf","checkLogin","cb","isLogin","cookies","http","getCookie","host","err","cookie","islogin","tryLogin","auth","synLogout","console","error","info","launchLogin","replace","log","checkCard","checkAuth"],"mappings":"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","file":"acc.js","sourceRoot":"/Users/apple/Documents/github/Javascript/vue2-paebank","sourcesContent":["import * as aladdin from 'aladdin';\n// const aladdin = require('aladdin')\n// const bow = require('bow')\nimport bow from 'bow';\nimport api from '../api/urls';\nimport * as ald from './ald';\n\nconst ua = navigator.userAgent+'';\n\n// 291001～291007\nexport function getForwardUrl(){\n    // let a = api.onelogin;\n    let prefix='',search='',hash='',param = '',ohash='',returnUrl='';\n    let url = location.href;\n    let urls = url.split('#');\n    url = urls[0];\n    hash = urls[1]?urls[1]:'';\n    url = url.split('?');\n    search = url[1]?url[1]:'';\n    prefix = url[0];\n    if(hash){\n        // search加在单页hash后面如：index.html?aa&bb&cc/#/a?b&c&d\n        hash = hash.split('?');\n        ohash = hash[0];\n        param = hash[1]?hash[1]:'';\n    }\n    // returnUrl = prefix+(search?'&'+search:'')+(param?'&'+param:'')+ohash;\n    if(search){\n        search = '?'+search;\n        if(param){\n            param = '&'+param\n        }\n    }else{\n        if(param){\n            param = '?'+param\n        }\n    }\n    returnUrl = prefix + search + param + '#'+ohash;\n    let forwardUrl = api.onelogin;\n    forwardUrl = forwardUrl.split('#');\n    return forwardUrl[0] + '?returnURL=' + encodeURIComponent(returnUrl) + (forwardUrl[1]?'#' + forwardUrl[1]:'');\n    // return forwardUrl[0] + '?returnURL='+ encodeURIComponent(returnUrl)+(forwardUrl[1]?'#'+forwardUrl[1]:'');\n}\n\n// 检测是否需要replace跳转\nconst replaceList = ['pay.html','index.html'];\nexport function checkReplace(){\n    let p = location.pathname;\n    let a;\n    if(p.length>1){\n        a = p.substr(p.lastIndexOf('/')+1,p.length-1);\n        if(replaceList.indexOf(a) != -1){\n            return true;\n        }\n        return false;\n    }else{\n        return false;\n    }\n}\n\n// 检测是否登录，此方法不能\nexport function checkLogin(cb){\n    let isLogin = false;\n    let cookies = bow.http.getCookie(location.host,'OMM',function(err,cookie){\n        if(err){\n            isLogin = false;\n        }else{\n            islogin = true;\n        }\n        if(typeof(cb) == 'function'){\n            cb(cookie);\n        }else{\n          cb(isLogin);\n        }\n    });\n}\n\n// 登录\n// App内？\n// 是否登录\n// 未登录弹出native登录\n\n// App外？\n// 是否有cookie or statusCode == 291001?\n// 跑#/onelogin\nexport function tryLogin(){\n    debugger;\n    if(ua.indexOf(\"AladdinHybrid\") != -1){\n        bow.auth.synLogout(function(err) {\n            if(err) {\n                console.error(\"登出异常！\");\n                return;\n            }\n            console.info(\"登出成功！\");\n            bow.auth.launchLogin();\n        });\n    }else{\n        //\n        if(checkReplace()){\n            location.replace(getForwardUrl());\n        }else{\n            console.log(getForwardUrl())\n            location.href = getForwardUrl();\n            // ald.navigator.forwardTo({title:'登录',url:getForwardUrl()});\n        }\n    }\n}\n\n// 检测处理邦卡\nexport function checkCard(){\n    //\n}\n\n// 检测身份验证\nexport function checkAuth(){\n    //\n}\n"]}